!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";var b=a(window),c=a(document),d=window.location,e=!0,f=!1,g=null,h=NaN,i=1/0,j="undefined",k="directive",l=".cropper",m=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,n=/^(x|y|width|height)$/,o=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,p="cropper-modal",q="cropper-hidden",r="cropper-invisible",s="cropper-move",t="cropper-crop",u="cropper-disabled",v="mousedown touchstart",w="mousemove touchmove",x="mouseup mouseleave touchend touchleave touchcancel",y="wheel mousewheel DOMMouseScroll",z="resize"+l,A="dblclick",B="build"+l,C="built"+l,D="dragstart"+l,E="dragmove"+l,F="dragend"+l,G=function(a){return"number"==typeof a},H=function(a,b){var c=[];return G(b)&&c.push(b),c.slice.apply(a,c)},I=function(a,b){var c=H(arguments,2);return function(){return a.apply(b,c.concat(H(arguments)))}},J=function(a){var b="timestamp="+(new Date).getTime();return a+(-1===a.indexOf("?")?"?":"&")+b},K=function(b,c){this.element=b,this.$element=a(b),this.defaults=a.extend({},K.DEFAULTS,a.isPlainObject(c)?c:{}),this.$original=g,this.ready=f,this.built=f,this.cropped=f,this.rotated=f,this.disabled=f,this.replaced=f,this.init()},L=Math.sqrt,M=Math.min,N=Math.max,O=Math.abs,P=Math.sin,Q=Math.cos,R=parseFloat;K.prototype={constructor:K,support:{canvas:a.isFunction(a("<canvas>")[0].getContext)},init:function(){var b=this.defaults;a.each(b,function(a,c){switch(a){case"aspectRatio":b[a]=O(R(c))||h;break;case"autoCropArea":b[a]=O(R(c))||.8;break;case"minWidth":case"minHeight":b[a]=O(R(c))||0;break;case"maxWidth":case"maxHeight":b[a]=O(R(c))||i}}),this.image={rotate:0},this.load()},load:function(){var b,c,d=this,f=this.$element,g=this.element,h=this.image,i="";f.is("img")?c=f.prop("src"):f.is("canvas")&&this.support.canvas&&(c=g.toDataURL()),c&&(this.replaced&&(h.rotate=0),this.defaults.checkImageOrigin&&this.isCrossOriginURL(c)&&(i=" crossOrigin",c=J(c)),this.$clone=b=a("<img"+i+' src="'+c+'">'),b.one("load",function(){h.naturalWidth=this.naturalWidth||b.width(),h.naturalHeight=this.naturalHeight||b.height(),h.aspectRatio=h.naturalWidth/h.naturalHeight,d.url=c,d.ready=e,d.build()}),b.addClass(r).prependTo("body"))},isCrossOriginURL:function(a){var b=a.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return!b||b[1]===d.protocol&&b[2]===d.hostname&&b[3]===d.port?f:e},build:function(){var b,c,d=this.$element,g=this.defaults;this.ready&&(this.built&&this.unbuild(),d.one(B,g.build),b=a.Event(B),d.trigger(b),b.isDefaultPrevented()||(this.$cropper=c=a(K.TEMPLATE),d.addClass(q),this.$clone.removeClass(r).prependTo(c),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(q).prependTo(this.$cropper),this.originalImage=a.extend({},this.image)),this.$container=d.parent(),this.$container.append(c),this.$canvas=c.find(".cropper-canvas"),this.$dragger=c.find(".cropper-dragger"),this.$viewer=c.find(".cropper-viewer"),g.autoCrop?this.cropped=e:this.$dragger.addClass(q),g.modal&&this.$canvas.addClass(p),!g.dashed&&this.$dragger.find(".cropper-dashed").addClass(q),!g.movable&&this.$dragger.find(".cropper-face").data(k,"move"),!g.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(q),this.addListeners(),this.initPreview(),this.built=e,g.dragCrop&&this.setDragMode("crop"),this.update(),this.replaced=f,d.one(C,g.built),d.trigger(C)))},unbuild:function(){this.built&&(this.built=f,this.removeListeners(),this.$preview.empty(),this.$preview=g,this.$dragger=g,this.$canvas=g,this.$container=g,this.$cropper.remove(),this.$cropper=g)},update:function(a){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),a?(this.setData(a,e),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(a.proxy(this.update,this,this.getData()),200)},preview:function(){var b=this.image,c=this.dragger,d=b.width,e=b.height,f=c.left-b.left,g=c.top-b.top;this.$viewer.find("img").css({width:d,height:e,marginLeft:-f,marginTop:-g}),this.$preview.each(function(){var b=a(this),h=b.width()/c.width;b.find("img").css({width:d*h,height:e*h,marginLeft:-f*h,marginTop:-g*h})})},addListeners:function(){var d=this.defaults;this.$element.on(D,d.dragstart).on(E,d.dragmove).on(F,d.dragend),this.$cropper.on(v,a.proxy(this.dragstart,this)).on(A,a.proxy(this.dblclick,this)),d.zoomable&&this.$cropper.on(y,a.proxy(this.wheel,this)),d.multiple?this.$cropper.on(w,a.proxy(this.dragmove,this)).on(x,a.proxy(this.dragend,this)):c.on(w,this._dragmove=I(this.dragmove,this)).on(x,this._dragend=I(this.dragend,this)),b.on(z,this._resize=I(this.resize,this))},removeListeners:function(){var a=this.defaults;this.$element.off(D,a.dragstart).off(E,a.dragmove).off(F,a.dragend),this.$cropper.off(v,this.dragstart).off(A,this.dblclick),a.zoomable&&this.$cropper.off(y,this.wheel),a.multiple?this.$cropper.off(w,this.dragmove).off(x,this.dragend):c.off(w,this._dragmove).off(x,this._dragend),b.off(z,this._resize)},initPreview:function(){var b='<img src="'+this.url+'">';this.$preview=a(this.defaults.preview),this.$viewer.html(b),this.$preview.html(b).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var a=this.$container,b=this.defaults;this.container={width:N(a.width(),b.minContainerWidth),height:N(a.height(),b.minContainerHeight)}},initCropper:function(){var a,b=this.container,c=this.image;c.naturalWidth*b.height/c.naturalHeight-b.width>=0?(a={width:b.width,height:b.width/c.aspectRatio,left:0},a.top=(b.height-a.height)/2):(a={width:b.height*c.aspectRatio,height:b.height,top:0},a.left=(b.width-a.width)/2),this.$cropper.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.cropper=a},initImage:function(){var b=this.image,c=this.cropper,d={_width:c.width,_height:c.height,width:c.width,height:c.height,left:0,top:0,ratio:c.width/b.naturalWidth};this.defaultImage=a.extend({},b,d),b._width!==c.width||b._height!==c.height?a.extend(b,d):(b=a.extend({},d,b),this.replaced&&(b.ratio=d.ratio)),this.image=b,this.renderImage()},renderImage:function(a){var b=this.image;"zoom"===a&&(b.left-=(b.width-b.oldWidth)/2,b.top-=(b.height-b.oldHeight)/2),b.left=M(N(b.left,b._width-b.width),0),b.top=M(N(b.top,b._height-b.height),0),this.$clone.css({width:b.width,height:b.height,marginLeft:b.left,marginTop:b.top}),a&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var b,c,d=this.defaults,e=this.cropper,f=d.aspectRatio||this.image.aspectRatio,g=this.image.ratio;c=e.height*f-e.width>=0?{height:e.width/f,width:e.width,left:0,top:(e.height-e.width/f)/2,maxWidth:e.width,maxHeight:e.width/f}:{height:e.height,width:e.height*f,left:(e.width-e.height*f)/2,top:0,maxWidth:e.height*f,maxHeight:e.height},c.minWidth=0,c.minHeight=0,d.aspectRatio?(isFinite(d.maxWidth)?(c.maxWidth=M(c.maxWidth,d.maxWidth*g),c.maxHeight=c.maxWidth/f):isFinite(d.maxHeight)&&(c.maxHeight=M(c.maxHeight,d.maxHeight*g),c.maxWidth=c.maxHeight*f),d.minWidth>0?(c.minWidth=N(0,d.minWidth*g),c.minHeight=c.minWidth/f):d.minHeight>0&&(c.minHeight=N(0,d.minHeight*g),c.minWidth=c.minHeight*f)):(c.maxWidth=M(c.maxWidth,d.maxWidth*g),c.maxHeight=M(c.maxHeight,d.maxHeight*g),c.minWidth=N(0,d.minWidth*g),c.minHeight=N(0,d.minHeight*g)),c.minWidth=M(c.maxWidth,c.minWidth),c.minHeight=M(c.maxHeight,c.minHeight),b=a.extend({},c),b.width=N(c.minWidth,c.width*d.autoCropArea),b.height=N(c.minHeight,c.height*d.autoCropArea),b.left=(e.width-b.width)/2,b.top=(e.height-b.height)/2,b.oldLeft=c.oldLeft=c.left,b.oldTop=c.oldTop=c.top,this.autoCropDragger=b,this.defaultDragger=a.extend({},c),this.dragger=c},renderDragger:function(){var a=this.dragger,b=this.cropper;a.width>a.maxWidth?(a.width=a.maxWidth,a.left=a.oldLeft):a.width<a.minWidth&&(a.width=a.minWidth,a.left=a.oldLeft),a.height>a.maxHeight?(a.height=a.maxHeight,a.top=a.oldTop):a.height<a.minHeight&&(a.height=a.minHeight,a.top=a.oldTop),a.left=M(N(a.left,0),b.width-a.width),a.top=M(N(a.top,0),b.height-a.height),a.oldLeft=a.left,a.oldTop=a.top,this.dragger=a,this.disabled||this.defaults.done(this.getData()),this.$dragger.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.preview()},reset:function(b){this.cropped&&!this.disabled&&(b&&(this.defaults.data={}),this.image=a.extend({},this.defaultImage),this.renderImage(),this.dragger=a.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&!this.disabled&&(this.cropped=f,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(p),this.$dragger.addClass(q))},destroy:function(){var a=this.$element;this.ready||this.$clone.off("load").remove(),this.unbuild(),a.removeClass(q).removeData("cropper"),this.rotated&&a.attr("src",this.$original.attr("src"))},replace:function(b,c){var d,g=this,h=this.$element,i=this.element;!this.disabled&&b&&b!==this.url&&b!==h.attr("src")&&(c||(this.rotated=f,this.replaced=e),h.is("img")?(h.attr("src",b),this.load()):h.is("canvas")&&this.support.canvas&&(d=i.getContext("2d"),a('<img src="'+b+'">').one("load",function(){i.width=this.width,i.height=this.height,d.clearRect(0,0,i.width,i.height),d.drawImage(this,0,0),g.load()})))},setData:function(b,c){var d=this.cropper,e=this.dragger,f=this.image,h=this.defaults.aspectRatio;this.built&&!this.disabled&&typeof b!==j&&((b===g||a.isEmptyObject(b))&&(e=a.extend({},this.autoCropDragger)),a.isPlainObject(b)&&!a.isEmptyObject(b)&&(c||(this.defaults.data=b),b=this.transformData(b),G(b.x)&&b.x<=d.width-f.left&&(e.left=b.x+f.left),G(b.y)&&b.y<=d.height-f.top&&(e.top=b.y+f.top),h?G(b.width)&&b.width<=e.maxWidth&&b.width>=e.minWidth?(e.width=b.width,e.height=e.width/h):G(b.height)&&b.height<=e.maxHeight&&b.height>=e.minHeight&&(e.height=b.height,e.width=e.height*h):(G(b.width)&&b.width<=e.maxWidth&&b.width>=e.minWidth&&(e.width=b.width),G(b.height)&&b.height<=e.maxHeight&&b.height>=e.minHeight&&(e.height=b.height))),this.dragger=e,this.renderDragger())},getData:function(a){var b=this.dragger,c=this.image,d={};return this.built&&(d={x:b.left-c.left,y:b.top-c.top,width:b.width,height:b.height},d=this.transformData(d,e,a)),d},transformData:function(b,c,d){var e=this.image.ratio,f={};return a.each(b,function(a,b){b=R(b),n.test(a)&&!isNaN(b)&&(f[a]=c?d?Math.round(b/e):b/e:b*e)}),f},setAspectRatio:function(a){var b="auto"===a;this.disabled||(a=R(a),(b||!isNaN(a)&&a>0)&&(this.defaults.aspectRatio=b?h:a,this.built&&(this.initDragger(),this.renderDragger(),this.setData(this.defaults.data))))},getImageData:function(){var b={};return this.ready&&a.each(this.image,function(a,c){o.test(a)&&(b[a]=c)}),b},getDataURL:function(b,c,d){var e,f=a("<canvas>")[0],g=this.getData(),h="";return a.isPlainObject(b)||(d=c,c=b,b={}),b=a.extend({width:g.width,height:g.height},b),this.cropped&&this.support.canvas&&(f.width=b.width,f.height=b.height,e=f.getContext("2d"),"image/jpeg"===c&&(e.fillStyle="#fff",e.fillRect(0,0,b.width,b.height)),e.drawImage(this.$clone[0],g.x,g.y,g.width,g.height,0,0,b.width,b.height),h=f.toDataURL(c,d)),h},setDragMode:function(a){var b=this.$canvas,c=this.defaults,d=f,g=f;if(this.built&&!this.disabled){switch(a){case"crop":c.dragCrop&&(d=e,b.data(k,a));break;case"move":g=e,b.data(k,a);break;default:b.removeData(k)}b.toggleClass(t,d).toggleClass(s,g)}},enable:function(){this.built&&(this.disabled=f,this.$cropper.removeClass(u))},disable:function(){this.built&&(this.disabled=e,this.$cropper.addClass(u))},rotate:function(a){var b=this.image;a=R(a)||0,this.built&&0!==a&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=e,a=b.rotate=(b.rotate+a)%360,this.replace(this.getRotatedDataURL(a),!0))},getRotatedDataURL:function(b){var c=a("<canvas>")[0],d=c.getContext("2d"),e=b*Math.PI/180,f=O(b)%180,g=f>90?180-f:f,h=g*Math.PI/180,i=this.originalImage,j=i.naturalWidth,k=i.naturalHeight,l=O(j*Q(h)+k*P(h)),m=O(j*P(h)+k*Q(h));return c.width=l,c.height=m,d.save(),d.translate(l/2,m/2),d.rotate(e),d.drawImage(this.$original[0],-j/2,-k/2,j,k),d.restore(),c.toDataURL()},zoom:function(a){var b,c,d,e=this.image;a=R(a),this.built&&a&&!this.disabled&&this.defaults.zoomable&&(b=e.width*(1+a),c=e.height*(1+a),d=b/e._width,d>10||(1>d&&(b=e._width,c=e._height),this.setDragMode(1>=d?"crop":"move"),e.oldWidth=e.width,e.oldHeight=e.height,e.width=b,e.height=c,e.ratio=e.width/e.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(t)?"move":"crop")},wheel:function(a){var b=a.originalEvent,c=1;this.disabled||(a.preventDefault(),b.deltaY?c=b.deltaY>0?1:-1:b.wheelDelta?c=-b.wheelDelta/120:b.detail&&(c=b.detail>0?1:-1),this.zoom(.1*c))},dragstart:function(b){var c,d,g,h=b.originalEvent.touches,i=b;if(!this.disabled){if(h){if(g=h.length,g>1){if(!this.defaults.zoomable||2!==g)return;i=h[1],this.startX2=i.pageX,this.startY2=i.pageY,c="zoom"}i=h[0]}if(c=c||a(i.target).data(k),m.test(c)){if(b.preventDefault(),d=a.Event(D),this.$element.trigger(d),d.isDefaultPrevented())return;this.directive=c,this.cropping=f,this.startX=i.pageX,this.startY=i.pageY,"crop"===c&&(this.cropping=e,this.$canvas.addClass(p))}}},dragmove:function(b){var c,d,e=b.originalEvent.touches,f=b;if(!this.disabled){if(e){if(d=e.length,d>1){if(!this.defaults.zoomable||2!==d)return;f=e[1],this.endX2=f.pageX,this.endY2=f.pageY}f=e[0]}if(this.directive){if(b.preventDefault(),c=a.Event(E),this.$element.trigger(c),c.isDefaultPrevented())return;this.endX=f.pageX,this.endY=f.pageY,this.dragging()}}},dragend:function(b){var c;if(!this.disabled&&this.directive){if(b.preventDefault(),c=a.Event(F),this.$element.trigger(c),c.isDefaultPrevented())return;this.cropping&&(this.cropping=f,this.$canvas.toggleClass(p,this.cropped&&this.defaults.modal)),this.directive=""}},dragging:function(){var a,b=this.directive,c=this.image,d=this.cropper,g=d.width,h=d.height,i=this.dragger,j=i.width,k=i.height,l=i.left,m=i.top,n=l+j,o=m+k,p=e,r=this.defaults.aspectRatio,s={x:this.endX-this.startX,y:this.endY-this.startY};switch(r&&(s.X=s.y*r,s.Y=s.x/r),b){case"all":l+=s.x,m+=s.y;break;case"e":if(s.x>=0&&(n>=g||r&&(0>=m||o>=h))){p=f;break}j+=s.x,r&&(k=j/r,m-=s.Y/2),0>j&&(b="w",j=0);break;case"n":if(s.y<=0&&(0>=m||r&&(0>=l||n>=g))){p=f;break}k-=s.y,m+=s.y,r&&(j=k*r,l+=s.X/2),0>k&&(b="s",k=0);break;case"w":if(s.x<=0&&(0>=l||r&&(0>=m||o>=h))){p=f;break}j-=s.x,l+=s.x,r&&(k=j/r,m+=s.Y/2),0>j&&(b="e",j=0);break;case"s":if(s.y>=0&&(o>=h||r&&(0>=l||n>=g))){p=f;break}k+=s.y,r&&(j=k*r,l-=s.X/2),0>k&&(b="n",k=0);break;case"ne":if(r){if(s.y<=0&&(0>=m||n>=g)){p=f;break}k-=s.y,m+=s.y,j=k*r}else s.x>=0?g>n?j+=s.x:s.y<=0&&0>=m&&(p=f):j+=s.x,s.y<=0?m>0&&(k-=s.y,m+=s.y):(k-=s.y,m+=s.y);0>j&&0>k?(b="sw",k=0,j=0):0>j?(b="nw",j=0):0>k&&(b="se",k=0);break;case"nw":if(r){if(s.y<=0&&(0>=m||0>=l)){p=f;break}k-=s.y,m+=s.y,j=k*r,l+=s.X}else s.x<=0?l>0?(j-=s.x,l+=s.x):s.y<=0&&0>=m&&(p=f):(j-=s.x,l+=s.x),s.y<=0?m>0&&(k-=s.y,m+=s.y):(k-=s.y,m+=s.y);0>j&&0>k?(b="se",k=0,j=0):0>j?(b="ne",j=0):0>k&&(b="sw",k=0);break;case"sw":if(r){if(s.x<=0&&(0>=l||o>=h)){p=f;break}j-=s.x,l+=s.x,k=j/r}else s.x<=0?l>0?(j-=s.x,l+=s.x):s.y>=0&&o>=h&&(p=f):(j-=s.x,l+=s.x),s.y>=0?h>o&&(k+=s.y):k+=s.y;0>j&&0>k?(b="ne",k=0,j=0):0>j?(b="se",j=0):0>k&&(b="nw",k=0);break;case"se":if(r){if(s.x>=0&&(n>=g||o>=h)){p=f;break}j+=s.x,k=j/r}else s.x>=0?g>n?j+=s.x:s.y>=0&&o>=h&&(p=f):j+=s.x,s.y>=0?h>o&&(k+=s.y):k+=s.y;0>j&&0>k?(b="nw",k=0,j=0):0>j?(b="sw",j=0):0>k&&(b="ne",k=0);break;case"move":c.left+=s.x,c.top+=s.y,this.renderImage("move"),p=f;break;case"zoom":this.zoom(function(a,b,c,d,e,f){return(L(e*e+f*f)-L(c*c+d*d))/L(a*a+b*b)}(c.width,c.height,O(this.startX-this.startX2),O(this.startY-this.startY2),O(this.endX-this.endX2),O(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2,p=f;break;case"crop":s.x&&s.y&&(a=this.$cropper.offset(),l=this.startX-a.left,m=this.startY-a.top,j=i.minWidth,k=i.minHeight,s.x>0?s.y>0?b="se":(b="ne",m-=k):s.y>0?(b="sw",l-=j):(b="nw",l-=j,m-=k),this.cropped||(this.cropped=e,this.$dragger.removeClass(q)))}p&&(i.width=j,i.height=k,i.left=l,i.top=m,this.directive=b,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},K.TEMPLATE=function(a,b){return b=b.split(","),a.replace(/\d+/g,function(a){return b[a]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),K.DEFAULTS={aspectRatio:"auto",autoCropArea:.8,data:{},done:a.noop,preview:"",multiple:f,autoCrop:e,dragCrop:e,dashed:e,modal:e,movable:e,resizable:e,zoomable:e,rotatable:e,checkImageOrigin:e,minWidth:0,minHeight:0,maxWidth:i,maxHeight:i,minContainerWidth:300,minContainerHeight:150,build:g,built:g,dragstart:g,dragmove:g,dragend:g},K.setDefaults=function(b){a.extend(K.DEFAULTS,b)},K.other=a.fn.cropper,a.fn.cropper=function(b){var c,d=H(arguments,1);return this.each(function(){var e,f=a(this),g=f.data("cropper");g||f.data("cropper",g=new K(this,b)),"string"==typeof b&&a.isFunction(e=g[b])&&(c=e.apply(g,d))}),typeof c!==j?c:this},a.fn.cropper.Constructor=K,a.fn.cropper.setDefaults=K.setDefaults,a.fn.cropper.noConflict=function(){return a.fn.cropper=K.other,this}}),$(document).ready(function(){var a="",b=$(".cropper-wrapper > img"),c=pageData&&pageData._id&&pageData._id.$oid||"",d=currUser==c?!0:!1,e="",f=$(".cover-photo img"),g=8,h=g,i=-1*g,j=4;$(".js-rain-coat").hide(),d?$(".js-non-owner").remove():$(".msg-cover").remove();var k=function(a){var b="",c=0,d=0,e=null;for(var f in a)if(a[f]){e=$('span[data-rating="'+f+'"]'),c+=a[f].value;var g=l(a[f].value);g&&(e.text(g),e.closest(".rating-wrpr").find(".rating-bar").css({width:10*g+"%"}),e.closest(".rating-wrpr").find(".n-votes").text(a[f].votes),d++)}var h=c/d;4>h?b="rating-bad":h>=4&&7.5>h?b="rating-avg":h>=7.5&&(b="rating-good"),$(".js-rating-avg").addClass(b).animate({width:10*h+"%"},2e3).find(".rating-box").show().animate({left:10*h+"%"},2e3),h=l(h),h&&$(".js-rating").text(h)},l=function(a){return a=Math.round(10*a)/10,a?a=2==(a+"").length||(a+"").split(".").length>1?a:a+".0":0},m=function(d){d.heroImg&&$("body").innerWidth()>700&&$(".cover-photo img").attr("src",d.heroImg);var g=150,h=g;if((d.team||[]).length>0){for(var i=0,l=d.team,m=l.length;m>i;i++)Pluto.Templates.renderTemplate("banner-person-img",l[i],".js-caterpillar-team"),h+=g;$(".js-caterpillar-team").css({height:g+"px"}),h<$("body").innerWidth()&&$(".js-team .caterpillar").css({width:h+"px"})}else $(".js-team").remove();if(h=g,(d.achievers||[]).length>0){for(var i=0,l=d.achievers,m=l.length;m>i;i++)Pluto.Templates.renderTemplate("banner-person-img",l[i],".js-caterpillar-achvrs"),h+=g;$(".js-caterpillar-achvrs").css({height:g+"px"}),h<$("body").innerWidth()&&$(".js-achvrs .caterpillar").css({width:h+"px"})}else $(".js-achvrs").remove();if(d.dateOfJoining){var n=new Date(d.dateOfJoining);$("#js-doj span").text(function(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]}()+" "+n.getDate()+", "+n.getFullYear())}else $("#js-doj").remove();if(k(d.rating),(d.reviews||[]).length>0)for(var i=0,l=d.reviews,m=l.length;m>i;i++)l[i]._id&&l[i]._id.$oid&&(l[i].pid=l[i]._id.$oid),Pluto.Templates.renderTemplate("inst-review",l[i],".js-reviews");else $(".js-reviews").parent().prev().remove(),$(".js-reviews").parent().remove();for(var o=$(".tab-container"),p=$(".tab-content-container"),i=0,l=d.courseList,m=l.length;m>i;i++){o.append('<a href="#" class="tab" data-target="tab-content-'+i+'">'+l[i].examName+"</a>"),p.append('<div id="tab-content-'+i+'" class="tab-content" />');for(var q=0,r=l[i].courses,s=r.length;s>q;q++)r[q]._id=(r[q]._id||{}).$oid,Pluto.Templates.renderTemplate("card-crse",r[q],"#tab-content-"+i)}d.courseList.length&&($(".tab-container").closest(".wall-main-cell").append('<p class="t-right"><a href="'+wallOwner+'/courses">view all</a></p>'),$(".tab:eq(0)").addClass("tab-active"));var t=$("#slCenters");if((d.centers||[]).length>0)for(i=0,l=d.centers,m=l.length;m>i;i++)j>i&&Pluto.Templates.renderTemplate("card-cntr",l[i],".js-centers"),t.append('<option value="'+l[i].pid+'">'+l[i].city+" - "+l[i].address+"</option>");else $(".js-centers").parent().prev().remove(),$(".js-centers").parent().remove();$(".js-centers").find(".srch-result-wrapper").each(function(){$(this).addClass("srch-res-prvw")}),$(".js-entity-share").each(function(){$(this).attr("href",wallOwner+"/"+$(this).attr("href"))}),$("#js-cover-upld").on("click",function(a){$("#btCoverUpld").click(),a.preventDefault()}),$("#btDelImg").on("click",function(a){var b={instId:currUser,fileUrl:$(".cover-photo img").attr("src").trim(),type:"COVER_IMAGE"};$.post("institute/delete",JSON.stringify(b)).done(function(a){200===a.status&&(badger.show("Hero removed successfully"),$("#mdl-img-del").fadeOut("fast"),$(".cover-photo img").attr("src",""))}),a.preventDefault()}),$("#btCoverUpld").on("change",function(){var c=$(this)[0].files;c&&c[0]&&(e=c[0].type,a&&URL.revokeObjectURL(a),a=URL.createObjectURL(c[0]),b.closest(".modal").show(),b.cropper({aspectRatio:16/6,multiple:!1,dragCrop:!1,dashed:!1,movable:!0,resizable:!0}).cropper("replace",a),$(this).val(""))});var u=function(a,b,d){var g={id:c,fileData:d,fileFormat:"image",uploadType:a,description:b,mimeType:e};console.log("Uploading hero with:",g),$.post("institute/upload",JSON.stringify(g)).done(function(a){console.log("Response from server: "+JSON.stringify(a)),200===a.status?(f.attr("src",a.data),badger.show("Hero uploaded successfully")):badger.show("Hero upload failed","error",{stayTime:4})}).fail(function(a){console.log("Hero upload failed with response from server: "+JSON.stringify(a)),badger.show("Hero upload failed","error",{stayTime:4})})};$("#btImgCrop").on("click",function(){b.attr("src","").closest(".modal").fadeOut();var a=b.cropper("getDataURL");f.attr("src","assets/img/loading-tiny.gif"),u("COVER_IMAGE","Hero",a)}),$("#btImgCropCancel").on("click",function(){b.cropper("destroy"),b.closest(".modal").hide()}),$("#btErrorInfoSubmit").on("click",function(){var a=[];if($(".cb:checked").each(function(){a.push($(this).data("tag")||"")}),0===a.length)return void badger.show("Please select a field","error");if(1===a.length&&"other"===a[0])return void badger.show("Please write comments also","error");var b={instId:c,text:$("#tbErrorInfoText").val().trim(),tags:a};$.post("institute/reportError",JSON.stringify(b)).done(function(a){badger.show("Error reported successfully","success"),console.log("Response from server:",a)}).fail(function(a){console.log("Failed:",a)}),$(this).closest(".modal").fadeOut()}),$("#btShutdown").on("click",function(){var a={instId:c};$.post("institute/reportShutdown",JSON.stringify(a)).done(function(a){badger.show("Shutdown report sent successfully","success"),console.log("Response from server:",a)}).fail(function(a){console.log("Failed:",a)}),$(this).closest(".modal").fadeOut()}),$(".js-show-rating, .rating-box").on("click",function(a){var b=$(this).find(".js-rating-helper"),c=$(".all-rating"),d=c.data("isVisible");c.slideToggle("fast"),-1!==b.text().indexOf("details")&&(d?(b.text("view details"),c.data("isVisible",!1)):(b.text("hide details"),c.data("isVisible",!0)),a.preventDefault())})};if($(document).on("click",".tab",function(a){var b=$(this),c=b.data("target");$(".tab").removeClass("tab-active"),b.addClass("tab-active"),$(".tab-content").hide(),$("#"+c).show(),a.preventDefault()}),$(".js-modal-show").on("click",function(a){("js-cover-remove"!==$(this).attr("id")||$(".cover-photo img").attr("src"))&&$($(this).data("target")||"").show(),a.preventDefault()}),$(".js-modal-close").on("click",function(a){$(this).closest(".modal").fadeOut()}),currUser&&"student"===role&&($("#lnk-review").data("target","#mdl-review"),$("#frm-review-submit").data({"user-id":currUser,"inst-id":c})),"institute"===role&&$("#lnk-review").remove(),wallOwner){pageData&&m(pageData);for(var n=0,o=1,p=$(".tab"),q=p.length;q>o;o++)n+=parseInt(p.eq(o-1).css("width").split("px")[0]),p.eq(o).css({left:n+"px"});currUser&&d?($(".js-similar").parent().prev().remove(),$(".js-similar").parent().remove()):$.get("institute/getSimilar?exam="+((pageData.courseList[0]||{}).examName||"")+"&currentInst="+c+"&skip="+(i+g)+"&limit="+h,function(a){if(200===a.status&&(a.data||[]).length>0){for($(".js-similar").html(""),o=0,p=a.data,q=p.length;q>o;o++)p[o].noLazy=!0,Pluto.Templates.renderTemplate("card-inst",p[o],".js-similar");$(".js-similar").find(".srch-result-wrapper").each(function(){$(this).addClass("srch-res-prvw")})}else $(".js-similar").parent().prev().remove(),$(".js-similar").parent().remove()}),"student"===role&&$.get("institute/getUserReview?instituteId="+c,function(a){200===a.status&&($("#tbReviewContent").val(a.data[0].review),$("#rgRatingInfra").val((a.data[0].rating||{}).infra).change(),$("#rgRatingFaculty").val((a.data[0].rating||{}).faculty).change(),$("#rgRatingMaterial").val((a.data[0].rating||{}).material).change(),$("#reviewId").val(a.data[0]._id.$oid),a.data[0].centerId&&$("#slCenters").val(a.data[0].centerId))})}}),window.fbShareInit=function(){var a=$(".js-fbShare"),b=$(".js-fbShareCount"),c="http://www.facebook.com/sharer/sharer.php?u="+document.URL;a.prev("img").remove(),a.show().attr("href",c).on("click",function(a){window.open($(this).attr("href"),"popupWindow","width=540,height=300,scrollbars=yes"),a.preventDefault()}),b.text("--"),$.get("https://api.facebook.com/method/links.getStats?urls="+document.URL+"&format=json",function(a){a&&a.length&&b.text(a[0].share_count)})},$(document).ready(function(){Pluto&&Pluto.Validator&&Pluto.Validator.Password&&Pluto.Validator.Password.init({$input:$("#tbPwd1"),$pwdStrengthBar:$(".pwd-strength-bar")});var a={email:!1,username:!1,contactNum:!1},b="";$("#frm-reg").on("submit",function(b){var c=$("#tbName").val().trim(),d=$("#tbEmail").val().trim(),e=$("#tbUsername").val().trim(),f=$("#tbContactNo").val().trim(),g=$("#tbPwd1").val().trim(),h=$("#tbPwd2").val().trim(),i={},j=$(this).find(".pacer");j.css({width:"0%"}),$(".js-check-me").blur(),""===c||""===d||""===g||""===h||""===e||""===f?(badger.show("Incomplete form","error"),$("#tbName").focus()):g!==h?(badger.show("Passwords don't match","error"),$("#tbPwd1").focus()):Pluto.Validator.Password.isValid()?Pluto.Validator.Email.isValid(d)?Pluto.Validator.Username.isValid(e)?Pluto.Validator.PhoneNumber.isValid(f)?a.email&&a.username&&a.contactNum?(j.show().animate({width:"50%"}),$("#btRegister").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Registering..."),i.name=c,i.email=d,i.password=g,i.username=e,i.contactNum=f,$.post("register",JSON.stringify(i),function(a){j.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btRegister").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Register")}),200===a.status?window.location.href="../custommsg?code=MSG08":badger.show("Something went wrong, please try again","error")})):(badger.show("Please correct the unavailable fields","error"),$("#tbEmail").focus()):(badger.show("Please provide a valid mobile number","warn"),$("#tbContactNo").focus()):(badger.show("Please provide a valid username","warn"),$("#tbUsername").focus()):(badger.show("Please provide a valid email address","warn"),$("#tbEmail").focus()):(badger.show("Password is not strong enough","error"),$("#tbPwd1").focus()),b.preventDefault()}),$(".js-check-me").on("blur",function(){var b=$(this),c=b.val().trim(),d=b.attr("name");c&&("email"!==d||Pluto.Validator.Email.isValid(c))&&("username"!==d||Pluto.Validator.Username.isValid(c))&&("contactNum"!==d||Pluto.Validator.PhoneNumber.isValid(c))&&(b.closest(".tb-hint-wrapper").find(".auto-checker").html('<span class="fa fa-refresh fa-spin"></span>'),$.get("../login/checkAvailability?entity="+d+"&value="+c).done(function(c){return 200!==c.status?void b.closest(".tb-hint-wrapper").find(".auto-checker").html('<span class="fa fa-times-circle" style="color: #fe4365"></span>'):void(c.data.result?(b.closest(".tb-hint-wrapper").find(".auto-checker").html('<span class="fa fa-check-circle"></span>'),a[d]=!0):(b.closest(".tb-hint-wrapper").find(".auto-checker").html('<span class="fa fa-times-circle" style="color: #fe4365"></span>'),a[d]=!1))}))}),$("#frm-reg-user").on("submit",function(a){var b=$("#tbName").val().trim(),c=$("#tbEmail").val().trim(),d=$("#tbPwd1").val().trim(),e=$("#tbPwd2").val().trim(),f={},g=$(this).find(".pacer");g.css({width:"0%"}),""===b||""===c||""===d||""===e?(badger.show("Incomplete form","error"),$("#tbName").focus()):d!==e?(badger.show("Passwords don't match","error"),$("#tbPwd1").focus()):Pluto.Validator.Password.isValid()?Pluto.Validator.Email.isValid(c)?(g.show().animate({width:"33%"}),$("#btRegister").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Registering..."),$.get("login/checkAvailability?entity=email&value="+c).done(function(a){return g.show().animate({width:"66%"}),200!==a.status?void g.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btRegister").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Register")}):a.data.result?(f.name=b,f.email=c,f.password=d,void $.post("user/register",JSON.stringify(f),function(a){g.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btRegister").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Register")}),200===a.status?window.location.href="custommsg?code=MSG01&email="+c:badger.show("Something went wrong, please try again","error")})):(badger.show("Email already registered","error",{stayTime:4}),void g.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btRegister").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Register")}))})):(badger.show("Please provide a valid email address","warn"),$("#tbEmail").focus()):(badger.show("Password is not strong enough","error"),$("#tbPwd1").focus()),a.preventDefault()}),$("#frm-chng-pwd").on("submit",function(a){var b=$("#tbPwdOld").val().trim(),c=$("#tbPwd1").val().trim(),d=$("#tbPwd2").val().trim(),e={},f=$(this),g=$(this).find(".pacer");return g.css({width:"0%"}),f.data("no-click")?(f.data("no-click",""),void a.preventDefault()):(""===b||""===c||""===d?(badger.show("Please fill complete form","error"),$("#tbPwdOld").focus()):c!==d?(badger.show("Passwords don't match","error"),$("#tbPwd1").focus()):Pluto.Validator.Password.isValid()?(g.show().animate({width:"33%"}),$("#btChangePwd").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Changing..."),e.oldPassword=b,e.newPassword=c,$.post("changePassword",JSON.stringify(e),function(a){return g.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btChangePwd").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Change")}),1003===a.status?void badger.show("Old password is not correct","error"):200!==a.status?void badger.show("Couldn't process request, please try again","error"):(badger.show("Password changed successfully"),f.closest(".modal").hide(),void f.find("input").val(""))})):(badger.show("Password is not strong enough","error"),$("#tbPwd1").focus()),void a.preventDefault())}),$(".js-no-click").on("click",function(){$(this).closest("form").data("no-click","yes")}),$(".js-frm-chng-entity").on("submit",function(a){var b=$(this),c=b.find("input").eq(0).attr("name").trim(),d=b.find("input").eq(0).val().trim(),e=b.find("input").eq(0).data("entity-name").trim(),f=b.data("to-update").trim(),g=$("#frm-ver-pwd");return b.find("input").eq(0).focus(),b.data("no-click")?(b.data("no-click",""),void a.preventDefault()):(d?"email"===c&&!Pluto.Validator.Email.isValid(d)||"contactNum"===c&&!Pluto.Validator.PhoneNumber.isValid(d)||"username"===c&&!Pluto.Validator.Username.isValid(d)?badger.show(e+" is not valid","warn"):(g.data("entity",c),
g.data("value",d),g.data("dispName",e),g.data("toUpdate",f),$("#mdl-ver-pwd").show()):(badger.show("Please provide something to change","error"),b.find("input").eq(0).focus()),void a.preventDefault())}),$("#frm-ver-pwd").on("submit",function(a){var b=$(this),c=$(".js-frm-chng-entity"),d=b.find('input[type="password"]'),e=b.find("button").eq(0),f=b.find(".pacer"),g=b.data("entity"),h=b.data("value"),i=b.data("dispName"),j=b.data("toUpdate"),k=d.val().trim(),l={};return f.css({width:"0%"}),d.focus(),b.data("no-click")?(b.data("no-click",""),b.data("entity",""),b.data("value",""),b.data("dispName",""),b.data("toUpdate",""),d.val(""),void a.preventDefault()):(k?(f.show().animate({width:"33%"}),e.removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Verifying..."),$.post("../institute/isPasswordValid",JSON.stringify({password:k})).done(function(a){return 200!==a.status?(badger.show("Couldn't process request, please try again","error"),void f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),e.addClass("btn-sheen-intrctve").prop("disabled",!1).text("Verify")})):void(a.data?$.get("../login/checkAvailability?entity="+g+"&value="+h).done(function(a){return 200!==a.status?(badger.show("Couldn't process request, please try again","error"),void f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),e.addClass("btn-sheen-intrctve").prop("disabled",!1).text("Verify")})):void(a.data.result?(f.show().animate({width:"66%"}),l[g]=h,$.post("updateBasicInfo",JSON.stringify(l),function(a){return f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),e.addClass("btn-sheen-intrctve").prop("disabled",!1).text("Verify")}),200!==a.status?void badger.show("Couldn't process request, please try again","error"):("email"===g?badger.show("A verification email has been sent to "+h,{stayTime:10}):badger.show(i+" changed successfully"),"username"===g&&(window.location.href="../logout"),b.closest(".modal").hide(),c.closest(".modal").hide(),b.find("input").val(""),c.find("input").val(""),void $(j).text(h))})):(badger.show(i+" is unavailable","warn"),f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),e.addClass("btn-sheen-intrctve").prop("disabled",!1).text("Verify")}),d.val("").focus()))}):(badger.show("Wrong password","error"),f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),e.addClass("btn-sheen-intrctve").prop("disabled",!1).text("Verify")}),d.val("").focus()))})):(badger.show("Incomplete form","error"),d.focus()),void a.preventDefault())}),$("#frm-login").on("submit",function(a){var c=$(this),d=$("#tbLoginId").val().trim(),e=$("#tbPwd").val().trim(),f=c.find(".pacer");return f.css({width:"0%"}),b=c.data("context"),c.data("no-click")?(c.data("no-click",""),void a.preventDefault()):(""===d||""===e?(badger.show("Incomplete form","error"),$("#tbLoginId").focus()):(f.show().animate({width:"50%"}),$("#btLogin").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Logging in..."),$.post(("review"===b?"../":"")+"login",{loginID:d,password:e},function(a){f.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btLogin").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Login")}),200===a.status?"banner"===b||"review"===b?(badger.show("Login successful. Please wait..",{persist:!0}),window.location.reload()):window.location.replace("institute/portfolio"):1001===a.status?window.location.href="custommsg?code=MSG06&loginId="+d:1002===a.status&&badger.show("Invalid credentials","error")})),void a.preventDefault())}),$("#frm-forgot-pwd").on("submit",function(a){var b=$("#tbLoginId").val().trim(),c=$(this).find(".pacer");if(c.css({width:"0%"}),""===b)badger.show("Incomplete form","error"),$("#tbLoginId").focus();else{c.show().animate({width:"50%"}),$("#btResetPwd").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Submitting...");var d={loginID:b};$.post("user/forgotPassword",JSON.stringify(d)).done(function(a){c.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide()}),$("#btResetPwd").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Submit"),200===a.status?window.location.href="custommsg?code=MSG03&resendTo="+a.data.email:1004===a.status&&badger.show("We do not recognize any account associated with this login ID","error",{stayTime:4})})}a.preventDefault()}),$("#frm-supp").on("submit",function(a){var b=$("#tbName").val().trim(),c=$("#tbEmail").val().trim(),d=$("#slSuppType option:selected").text(),e=$("#tbSuppText").val().trim(),f={},g=$(this),h=$(this).find(".pacer");h.css({width:"0%"}),""===b||""===c||""===e?(badger.show("Incomplete form","error"),$("#tbName").focus()):Pluto.Validator.Email.isValid(c)?(h.show().animate({width:"50%"}),$("#btSuppSend").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Submitting..."),f.name=b,f.email=c,f.suppType=d,f.suppTxt=e,f.addedOn=Date.now(),f.prevUrl=getParameterByName("prevUrl"),$.post("support",JSON.stringify(f)).done(function(a){h.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btSuppSend").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Submit")}),g.find("input, textarea").val(""),badger.show("merainstitute.com support contacted successfully",{persist:!0})}).fail(function(a){console.error("Error occurred:",a)})):(badger.show("Please provide a valid email address","warn"),$("#tbEmail").focus()),a.preventDefault()}),$("#frm-advertise").on("submit",function(a){var b=$("#tbName").val().trim(),c=$("#tbEmail").val().trim(),d=$("#tbContactNo").val().trim(),e=$("#tbQuery").val().trim(),f={},g=$(this),h=$(this).find(".pacer");h.css({width:"0%"}),""===b||""===c||""===d||""===e?(badger.show("Incomplete form","error"),$("#tbName").focus()):Pluto.Validator.Email.isValid(c)?Pluto.Validator.PhoneNumber.isValid(d)?(h.show().animate({width:"50%"}),$("#btAdvReq").removeClass("btn-sheen-intrctve").prop("disabled",!0).text("Submitting..."),f.name=b,f.email=c,f.contactNum=d,f.query=e,$.post("advertise",JSON.stringify(f)).done(function(a){h.animate({width:"100%"},function(){$(this).css({width:"0%"}).hide(),$("#btAdvReq").addClass("btn-sheen-intrctve").prop("disabled",!1).text("Submit")}),200===a.status?(g.find("input, textarea").val(""),badger.show("Request submitted successfully",{persist:!0})):badger.show("Couldn't submit request, please try again","warn")}).fail(function(a){console.error("Error occurred:",a)})):(badger.show("Please provide a valid contact number","warn"),$("#tbContactNo").focus()):(badger.show("Please provide a valid email address","warn"),$("#tbEmail").focus()),a.preventDefault()}),$(".js-rating-slidr").on("change",function(){$(this).prev("label").find(".usr-rating").text($(this).val())}),$("#frm-review-submit").on("submit",function(a){var c=$(this),d=$("#tbReviewContent").val().trim(),e=parseInt($("#rgRatingInfra").val()),f=parseInt($("#rgRatingFaculty").val()),g=parseInt($("#rgRatingMaterial").val()),h=$("#slCenters option:selected").val(),i="-1"===h?"":$("#slCenters option:selected").text(),j=c.data("user-id"),k=c.data("inst-id");if(b=c.data("context"),c.data("no-click"))return c.data("no-click",""),void a.preventDefault();if(!j||!k)return badger.show("Review can't be submitted right now","error"),void a.preventDefault();if(!(d||e||f||g))return badger.show("Please write a review or rate before submiting","error"),void a.preventDefault();var l={userId:j,instId:k,reviewedOn:Date.now(),review:d,center:i,centerId:h,rating:{infra:e,faculty:f,material:g}};$.post(("review"===b?"../":"")+"institute/reviewAndRating",JSON.stringify(l)).done(function(a){200===a.status&&(badger.show("Review submitted for verification",{stayTime:5}),$("#reviewId").val(a.data._id&&a.data._id.$oid))}).fail(function(a){console.log("Failed:",a)}),c.closest(".modal").fadeOut(),a.preventDefault()}),$("#btDelReview").on("click",function(){var a=$(this),c=$("#reviewId").val().trim();if(b=a.data("context"),!c)return void badger.show("You need to add a review before deleting it","error");var d={_id:c,isDeleted:!0};$.post(("review"===b?"../":"")+"institute/reviewAndRating",JSON.stringify(d)).done(function(a){200===a.status&&(badger.show("Review deleted successfully"),$("#reviewId").val(""))}).fail(function(a){console.log("Failed:",a)}),a.closest(".modal").fadeOut(),$("#tbReviewContent").val(""),$("#slCenters").val("-1"),$(".js-rating-slidr").val(0).change(),$("#reviewId").val("")}),window.googleInitComplete=function(){$("#btLoginGoogle").prop("disabled",!1).find(".social-txt").text("Connect with Google")},window.fbInitComplete=function(){$("#btLoginFacebook").prop("disabled",!1).find(".social-txt").text("Connect with Facebook")},$("#btLoginFacebook").on("click",function(){var a=$("#facebookPacer");b=$(this).data("context"),a.css({width:"0%"}).show().animate({width:"25%"}).prev("button").prop("disabled",!0).find(".social-txt").text("Connecting with Facebook..."),FB.login(function(b){b.authResponse?(a.show().animate({width:"50%"}),FB.api("/me?fields=id,name,email,gender,age_range,birthday",function(b){a.show().animate({width:"75%"}),c(b)})):a.animate({width:"0%"}).hide().prev("button").prop("disabled",!1).find(".social-txt").text("Connect with Facebook")},{scope:"public_profile,email",auth_type:"rerequest"})});var c=function(a){var b=$("#facebookPacer");a.email?FB.api("/me/picture",{redirect:!1,type:"large"},function(c){b.show().animate({width:"90%"}),e(a.email,a.name,c.data.url,a.gender,a.birthday,a.age_range,a.id,"facebook")}):b.animate({width:"0%"}).hide().prev("button").prop("disabled",!1).find(".social-txt").text("Connect with Facebook")};$("#btLoginGoogle").on("click",function(){b=$(this).data("context"),gapi.auth.signIn({clientid:"408132528531-f5o8j8fnff057qca7fjn9qc5ga9h7i1g.apps.googleusercontent.com",cookiepolicy:"single_host_origin",callback:d,scope:"https://www.googleapis.com/auth/plus.profile.emails.read https://www.googleapis.com/auth/plus.login"})});var d=function(a){var b=$("#googlePacer");if("immediate_failed"===a.error);else if(b.css({width:"0%"}).show().animate({width:"25%"}).prev("button").prop("disabled",!0).find(".social-txt").text("Connecting with Google..."),a.status.signed_in){if("PROMPT"===a.status.method){var c=gapi.client.plus.people.get({userId:"me",fields:"id,displayName,image,gender,birthday,ageRange,emails"});b.show().animate({width:"65%"}),c.execute(function(a){b.show().animate({width:"80%"});for(var c="",d=0,f=a.emails||[],g=f.length;g>d;d++)"account"===a.emails[d].type&&(c=a.emails[d].value);var h=a.id,i=a.displayName,j=a.gender,k=a.image.url,l=a.ageRange,m=a.birthday;b.show().animate({width:"90%"}),e(c,i,k,j,m,l,h,"googlePlus")})}}else"access_denied"===a.error&&b.animate({width:"0%"}).hide().prev("button").prop("disabled",!1).find(".social-txt").text("Connect with Google")},e=function(a,c,d,e,f,g,h,i){var j={loginId:a,name:c,profileImg:d,gender:e,birthday:f,ageRange:g,socialId:h,socialType:i};$.post(("review"===b?"../":"")+"user/regin",JSON.stringify(j),function(a){200===a.status?"student"===a.data.role||"STUDENT"===a.data.role?"banner"===b||"review"===b?window.location.reload():window.location.href=".":window.location.href="institute/portfolio":console.log("Error in register. Status:",a.status,"; Desc:",a.statusDesc)})}});